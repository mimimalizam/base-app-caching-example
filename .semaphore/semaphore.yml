version: "v1.0"
name: First pipeline example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
 - name: "Casually listing cache store"
   task:
     jobs:
     - name: Cache list
       commands:
         - cache list
 - name: "Don't run build step based on something and don't fail the job"
   task:
     jobs:
     - name: Something = cache has_key exit status
       commands:
         - cache list
         - cache has_key penultimate || ls -lah
         - cache has_key penultimate || echo "skipping this command"
         - cache has_key penultimate || make deploy
         - cache has_key unavailable_key || ls -lah
     - name: Something = branch name
       commands:
         - if [ "$SEMAPHORE_GIT_BRANCH" = "master"  ]; then echo "it's master branch"; else echo "run this command only if branch is not master"; fi
         - if [ "$SEMAPHORE_GIT_BRANCH" != "ms/skip-build-step-if-cache-has-key"  ]; then echo "run when branch is not ms/skip-build-step-if-cache-has-key"; fi
